# VK Telegram Bot

Этот репозиторий содержит Telegram-бота, предназначенного для управления и взаимодействия с сообщениями из ВКонтакте (VK). Бот позволяет администраторам читать непрочитанные сообщения из VK, начинать диалоги и отвечать пользователям напрямую из Telegram. Он использует Long Poll API VK для получения новых сообщений и взаимодействия с администраторами.

## Основные функции

- **Получение непрочитанных сообщений**: Бот собирает непрочитанные сообщения из VK и отображает их администраторам.
- **Управление диалогами**: Администраторы могут начинать или завершать диалоги с пользователями VK через Telegram.
- **Ответы на сообщения**: Администраторы могут отправлять ответы пользователям VK прямо из чата Telegram.
- **Long Polling**: Бот в реальном времени получает новые сообщения из VK с помощью Long Poll API.
- **Поддержка нескольких администраторов**: Несколько администраторов могут управлять сообщениями VK.

## Предварительные требования

Перед использованием бота убедитесь, что у вас есть следующие данные:

1. **Токен Telegram-бота**: Получите токен, создав бота с помощью [BotFather](https://t.me/botfather) в Telegram.
2. **Токен API VK**: Сгенерируйте токен API VK с правами на чтение сообщений и управление диалогами.
3. **ID администраторов**: ID пользователей Telegram, которые будут управлять сообщениями VK.
4. **API-ключ OpenAI (опционально)**: Для интеграции с ChatGPT (в текущем коде закомментировано).

## Настройка

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/yourusername/vk-telegram-bot.git
    cd vk-telegram-bot
    ```

2. Установите зависимости:

    ```bash
    pip install -r requirements.txt
    ```

3. Настройте конфигурацию:

    - Создайте файл `config.py` в корневой директории с таким содержимым:

    ```python
    token_telegram_bot = 'ВАШ_ТЕЛЕГРАМ_ТОКЕН'
    vk_api = 'ВАШ_VK_API_ТОКЕН'
    chatgpt_api_key = 'ВАШ_ЧАТГПТ_API_КЛЮЧ'  # Опционально
    ```

    - Замените значения на ваши актуальные токены.

4. Добавьте ID администраторов в список `admins` в коде:

    ```python
    admins = [123456789, 987654321]
    ```

## Как работает бот

### 1. Запуск бота

Для запуска бота выполните команду:

```bash
python bot.py
```
## После запуска бот будет:

- Слушать новые сообщения из VK с помощью Long Poll API.
- Уведомлять администраторов о новых непрочитанных сообщениях.
- Позволять администраторам начинать диалог с пользователями VK через чат Telegram.

## Доступные команды для администраторов

- **/start**: Отображает приветственное сообщение и информацию о доступных командах.
- **/message**: Получает и отображает список непрочитанных сообщений VK с кнопками для начала диалога.

## Действия по кнопкам

- **Начать диалог**: Начинает новый диалог с пользователем VK.
- **Завершить диалог**: Завершает текущий диалог.
- **Прочитать сообщение**: Помечает сообщение VK как прочитанное и отображает его содержание.
- **Ответить**: Позволяет администратору отправить ответ пользователю VK напрямую из Telegram.

## Слушатель Long Poll

Бот использует Long Poll сервер VK для отслеживания новых входящих сообщений в реальном времени. Новые сообщения сохраняются в словарь `unread_messages`, и администраторы уведомляются через Telegram.

## Структура кода

- **`main()`**: Инициализирует и запускает бота, настраивая работу как с Telegram, так и с VK Long Poll API.
- **`get_recent_messages()`**: Получает последние сообщения из диалога VK.
- **`long_poll_listener()`**: Постоянно слушает новые сообщения из VK через Long Poll API.

### Обработчики команд:

- **/start**: Обрабатывает команду старта и предоставляет инструкции.
- **/message**: Отображает список непрочитанных сообщений VK для администраторов.
- **`handle_start_dialog()`**: Начинает диалог с пользователем VK.
- **`handle_end_dialog()`**: Завершает диалог.
- **`handle_reply()`**: Отправляет ответ на сообщение VK.

## Нереализованные функции

- **Ответ от Chat GPT**: В коде есть закомментированная возможность интеграции с ChatGPT для помощи в ответах на сообщения. Эта функция еще не реализована и требует дополнительной настройки и интеграции.

## Зависимости

- **aiogram**: Фреймворк для разработки Telegram-ботов.
- **aiohttp**: Асинхронный HTTP клиент для работы с Long Poll API VK.
- **vk_api**: Python-обёртка для работы с VK API.
- **pytz**: Библиотека для управления часовыми поясами.

## Вклад

Вы можете открывать новые задачи (issues) или отправлять запросы на слияние (pull requests), если хотите улучшить или добавить новые функции в бота.

---

Приятного использования бота для управления сообщениями VK через Telegram!

